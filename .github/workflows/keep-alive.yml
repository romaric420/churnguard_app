name: Keep Streamlit Alive
on:
  schedule:
    - cron: '*/15 * * * *'
  workflow_dispatch:

jobs:
  keep-alive:
    runs-on: ubuntu-latest
    steps:
      - name: Ping Streamlit App
        run: |
          echo "Ping de l'application Streamlit..."
          HTTP_STATUS=$(curl -s -o /dev/null -w "%{http_code}" --max-time 60 https://churnguard-app-version-1-0-0.streamlit.app/)
          echo "Status: $HTTP_STATUS"
          if [ "$HTTP_STATUS" -ne 200 ]; then
            echo "App endormie, retry dans 30s..."
            sleep 30
            curl -s -o /dev/null --max-time 60 https://churnguard-app-version-1-0-0.streamlit.app/
          fi
          echo "Ping termine"
